# PackingGame

## プロジェクト概要
パッキング問題を遊べる3Dパズルゲーム。直方体のアイテムを直方体のダンボール箱にすべて詰め込めたらステージクリア。問題はランダム自動生成され、難易度パラメータで制御する。

## 技術スタック
- Unity 6 (6000.0.26f1) + URP
- C# (.NET Standard 2.1)
- R3 (v1.3.0) - リアクティブプログラミング（イベント管理）
- UniTask (v2.5.10) - 非同期処理
- New Input System

## ゲーム仕様
- **次元**: 3D
- **アイテム形状**: 直方体のみ（サイズはfloat対応、整数に限らない）
- **UI言語**: 日本語
- **サウンド**: 後回し（初期実装には含めない）
- **プラットフォーム**: PC (Windows) + WebGL。キーボード+マウス前提
- **シーン構成**: シングルシーン（タイトル・パズル・クリアはUI切り替えで遷移）

## 操作仕様

### アイテム配置
- 画面下部にオーバーレイの2D UIでアイテム一覧を表示
- UIからドラッグすると3D空間に半透明のアイテムが出現し、マウスに追従
- XZ平面はマウス位置で決定
- Y座標は配置先の最高地点（床 or 設置済みアイテムの上面）に自動で合わせる（上から落とすイメージ）
- クリックで配置確定（不透明になる）
- 設置済みアイテムをクリックすると取り出してUIの一覧に戻す

### スナップ
- 壁・設置済みアイテムの面に磁石スナップ（閾値ベース、近づくと自動吸着）

### 回転（90度刻み）
- W/S: X軸回転
- A/D: Y軸回転
- Q/E: Z軸回転

### やり直し
- Undo/Redo（Ctrl+Z / Ctrl+Y）: アイテムの配置と取り出し操作が対象
- 全アイテムリセットボタン

## カメラ仕様
- 基本視点: 真上から見下ろし
- 移動範囲: 球殻の上部を切った範囲（上半球の上部）でカメラ回転可能
- 操作方法: マウス右ドラッグ
- ズーム: なし（箱のサイズに応じた固定距離で自動調整）

## 視覚仕様

### 箱の表示
- 高さベースのフェードアウトシェーダー
- 指定高さ以上のアイテムをフェードアウトで表示
- スライダー等で表示高さを調整可能

### アイテムの見た目
- ランダム色の直方体（アイテムごとに異なる単色）

## ゲーム進行

### フロー
タイトル画面 → 「始める」→ パズル → クリア → 次のランダムステージ → …（エンドレス）

### 難易度
- 毎回ランダム（箱サイズ・アイテム数・形状がランダムに決定）
- 段階的な上昇はなし

### ステージ生成アルゴリズム（逆算方式）
1. ランダムなサイズの箱を決定
2. 箱の内部空間を再帰的に分割してアイテムを生成
   - 箱全体を1つの直方体として開始
   - ランダムな軸（X/Y/Z）でランダムな位置で切断 → 2つの直方体に分割
   - 各直方体をさらに再帰的に切断
   - 目標アイテム数に達したら停止
3. 生成されたアイテムをランダムに回転させた状態でプレイヤーに提示

この方式により、元の箱にぴったり収まる分割から生まれたアイテムなので必ず解が存在する。

### ステージ生成パラメータ（デフォルト値、変数で調整可能）
- 箱の各辺サイズ: 3.0〜8.0
- アイテム数: 5〜10個
- 分割時の最小辺サイズ: 0.5（極端に薄いアイテムの防止）

### クリア判定
- 全アイテムが箱の中に収まり、アイテム同士が重ならない状態で自動判定・即クリア
- はみ出し不可
- 許容誤差: 0.01（float比較のため）

## アーキテクチャ方針
- MVP/シンプル構成（MonoBehaviour中心）
- 過度な抽象化・DIフレームワーク不要
- R3でイベント管理、UniTaskで非同期処理を使い分ける

## コーディング規約
- C# 標準命名規則（PascalCase: クラス・メソッド・プロパティ、camelCase: ローカル変数・引数、_camelCase: privateフィールド）
- コメントは日本語OK
- 1ファイル1クラスを基本とする
- 攻撃的プログラミング: エラーを握りつぶさない。nullチェックは必要な場合のみ。

## MCP ツール利用方針
- **unity-natural-mcp**: テスト実行、コンパイルエラー確認、コンソールログ取得に使用
- **voicevox**: 開発中の通知・報告用（ゲーム内では不使用）。speaker=3（ずんだもん）を使用
- **github**: リポジトリ管理、Issue/PR操作

## ディレクトリ構成
```
Assets/
  Scenes/       # シーンファイル
  Scripts/       # C#スクリプト
  Prefabs/       # プレハブ（必要時作成）
  Materials/     # マテリアル（必要時作成）
```

## ビルド・実行
- Unity Editorから再生で動作確認
- スクリプト変更後は `RefreshAssets` でコンパイル、`GetCompileLogs` でエラー確認
